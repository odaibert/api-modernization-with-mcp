{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"Modernize Your APIs for the AI Agent Era","text":""},{"location":"#expose-rest-apis-as-mcp-servers-through-azure-api-management","title":"Expose REST APIs as MCP Servers through Azure API Management","text":"<p>\"Your APIs are becoming tools. Your users are becoming agents. Your platform needs to adapt.\" \u2014 Azure API Management now supports MCP</p>"},{"location":"#about-this-workshop","title":"About This Workshop","text":"<p>The Model Context Protocol (MCP) is an open standard that turns your APIs into tools that AI agents can discover, understand, and invoke. Instead of writing custom glue code for every agent framework, you wrap your API once and every MCP-compatible client can use it.</p> <p>Azure API Management acts as a single, secure control plane for exposing and governing these MCP capabilities. No new infrastructure. Secure by default. Built for the future.</p> <p>This workshop walks you through modernizing a traditional REST API \u2014 a Product Catalog service \u2014 into an MCP-compliant server that AI agents can discover and invoke, all governed through Azure API Management.</p> <p>What Makes This Workshop Unique</p> <p> Learn by Building \u2014 Deploy real Azure infrastructure, not simulated environments</p> <p> Enterprise-Grade Security \u2014 API keys, managed identity, RBAC \u2014 all wired up from the start</p> <p> Agent-Ready \u2014 Test with Microsoft Agent Framework, VS Code Copilot, and MCP Inspector</p> <p> Infrastructure as Code \u2014 Full Bicep deployment you can adapt for production</p> <p> Interactive Notebook \u2014 Step through at your own pace with a Jupyter notebook</p>"},{"location":"#the-modernization-journey","title":"The Modernization Journey","text":"<p>Your journey follows a step-by-step progression. Each stage builds on the last, from local validation to a fully governed MCP endpoint with AI agent orchestration.</p> <ul> <li> <p> Step 0: Initialize</p> <p>Set variables and generate unique resource names for isolated, repeatable runs</p> </li> <li> <p> Step 1: Verify Azure CLI</p> <p>Confirm you're logged in with the right subscription and permissions</p> </li> <li> <p> Local Test: Validate MCP Server</p> <p>Start the MCP server locally and verify all 5 tools are discoverable before deploying</p> </li> <li> <p> Step 2: Deploy to Azure</p> <p>Provision APIM, Container Apps, AI Foundry, and monitoring via Bicep</p> </li> <li> <p> Step 3: Get Outputs</p> <p>Retrieve gateway URLs, subscription keys, and resource names</p> </li> <li> <p> Step 4: Build &amp; Deploy</p> <p>Build the container image in ACR and deploy to Container Apps</p> </li> <li> <p> Test: Discover &amp; Call Tools</p> <p>Connect to APIM and invoke all 5 MCP tools end-to-end through the gateway</p> </li> <li> <p> Test: Agent Framework</p> <p>Run an AI agent that autonomously discovers and calls MCP tools to answer questions</p> </li> <li> <p> Test: VS Code Integration</p> <p>Configure the MCP server in GitHub Copilot Agent Mode for developer inner-loop</p> </li> <li> <p> Clean Up</p> <p>Delete all Azure resources created during the lab with a single command</p> </li> </ul> <p> Start the lab</p>"},{"location":"#what-youll-build","title":"What You'll Build","text":"<p>By the end of this workshop, you'll have modernized a REST API into a fully governed MCP endpoint:</p> <p>Deliverables</p> <p> MCP Server \u2014 Product Catalog API wrapped with FastMCP, serving 5 discoverable tools over Streamable HTTP</p> <p> APIM Gateway \u2014 Native MCP API type with subscription key authentication, monitoring, and policy enforcement</p> <p> AI Agent Demo \u2014 Microsoft Agent Framework orchestrating LLM + MCP tools, all through APIM</p> <p> VS Code Integration \u2014 MCP server configured for GitHub Copilot Agent Mode</p> <p> Infrastructure as Code \u2014 Complete Bicep templates you can adapt for your own APIs</p>"},{"location":"#why-azure-api-management-for-mcp","title":"Why Azure API Management for MCP?","text":"<p>APIM brings enterprise-grade governance to your MCP endpoints \u2014 the same way it governs your REST, GraphQL, and WebSocket APIs today:</p> Capability What APIM Provides Security OAuth 2.0, Microsoft Entra ID, API keys, JWT validation Monitoring Azure Monitor, Application Insights, real-time analytics Discovery Publish MCP tools to Azure API Center for organization-wide visibility Policies Rate limiting, caching, transformation on MCP traffic Unified plane Manage MCP alongside existing REST, GraphQL, and WebSocket APIs"},{"location":"#the-bigger-picture","title":"The Bigger Picture","text":"<p>This workshop demonstrates one of two patterns for bringing MCP to your organization through Azure API Management:</p> Pattern Description This Workshop Expose REST API as MCP APIM sits in front of a backend MCP server that wraps your existing APIs Pass-through existing MCP servers APIM proxies and governs traffic to MCP servers already in production \u2014 <p>Both patterns let you modernize without rewriting \u2014 your existing business logic stays the same, while gaining AI-agent accessibility, enterprise security, and centralized governance.</p>"},{"location":"#getting-started","title":"Getting Started","text":"<p>Ready to modernize your APIs? Follow these three simple steps:</p> Step 1: Clone the RepositoryStep 2: Verify PrerequisitesStep 3: Open the Notebook <pre><code>git clone https://github.com/odaibert/api-modernization-with-mcp.git\ncd api-modernization-with-mcp\n</code></pre> <p>See the Prerequisites page for detailed setup instructions.</p> <p>Open <code>labs/expose-rest-api-as-mcp/expose-rest-api-as-mcp.ipynb</code> in VS Code and click Run All.</p> <p>No MCP Expertise Required</p> <p>This workshop is designed for developers of all skill levels. If you can write Python code and navigate the Azure Portal, you're ready to modernize!</p>"},{"location":"#reference-materials","title":"Reference Materials","text":"<p>Throughout this workshop, we reference the official Azure documentation for MCP support in API Management:</p> <ul> <li> Blog: Azure API Management now supports MCP</li> <li> Expose APIs as MCP servers</li> <li> Connect external MCP servers</li> <li> Secure MCP access</li> <li> Discover tools in API Center</li> <li> Microsoft Agent Framework</li> <li> Model Context Protocol specification</li> <li> Azure-Samples/AI-Gateway</li> </ul>"},{"location":"architecture/","title":"Architecture","text":""},{"location":"architecture/#overview","title":"Overview","text":"<p>This solution modernizes an existing REST API \u2014 a Product Catalog service \u2014 so that AI agents can discover and invoke it using the Model Context Protocol (MCP). Azure API Management acts as the secure, enterprise-grade control plane that fronts the MCP server, authenticates callers, applies policies, and provides full observability.</p> <p>The API Modernization Imperative</p> <p>\"Your APIs are becoming tools. Your users are becoming agents. Your platform needs to adapt.\"</p>"},{"location":"architecture/#solution-architecture","title":"Solution Architecture","text":"<pre><code>                        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                        \u2502           MCP Clients                       \u2502\n                        \u2502                                             \u2502\n                        \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n                        \u2502  \u2502 Agent       \u2502  \u2502 VS Code  \u2502  \u2502 MCP    \u2502 \u2502\n                        \u2502  \u2502 Framework   \u2502  \u2502 Copilot  \u2502  \u2502Inspect.\u2502 \u2502\n                        \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518 \u2502\n                        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                  \u2502              \u2502            \u2502\n                          Streamable HTTP + api-key header\n                                  \u2502              \u2502            \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Azure Resource Group            \u2502              \u2502            \u2502                      \u2502\n\u2502                                 \u25bc              \u25bc            \u25bc                      \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502                Azure API Management (BasicV2 SKU)                           \u2502  \u2502\n\u2502  \u2502                                                                             \u2502  \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u2502  \u2502\n\u2502  \u2502  \u2502 Product Catalog MCP API   \u2502    \u2502 Azure OpenAI Inference API    \u2502         \u2502  \u2502\n\u2502  \u2502  \u2502 \u2022 Type: mcp (native)      \u2502    \u2502 \u2022 Type: REST (OpenAPI import) \u2502         \u2502  \u2502\n\u2502  \u2502  \u2502 \u2022 Transport: streamable   \u2502    \u2502 \u2022 Auth: Managed Identity      \u2502         \u2502  \u2502\n\u2502  \u2502  \u2502 \u2022 Path: /product-catalog  \u2502    \u2502 \u2022 Path: /inference            \u2502         \u2502  \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502                   \u2502                                  \u2502                             \u2502\n\u2502                   \u25bc                                  \u25bc                             \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510          \u2502\n\u2502  \u2502  Azure Container App         \u2502  \u2502  Azure AI Foundry                \u2502          \u2502\n\u2502  \u2502  \u2022 FastMCP + Starlette       \u2502  \u2502  \u2022 GPT-4o-mini deployment        \u2502          \u2502\n\u2502  \u2502  \u2022 Streamable HTTP at /mcp   \u2502  \u2502  \u2022 Chat completions + tool-use   \u2502          \u2502\n\u2502  \u2502  \u2022 5 tools (catalog ops)     \u2502  \u2502  \u2022 Foundry project               \u2502          \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518          \u2502\n\u2502                                                                                   \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502  Observability: Log Analytics + Application Insights                        \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"architecture/#end-to-end-request-flow","title":"End-to-End Request Flow","text":""},{"location":"architecture/#mcp-tool-discovery-invocation","title":"MCP Tool Discovery &amp; Invocation","text":"<pre><code>MCP Client                    APIM                         Container App\n    \u2502                          \u2502                                \u2502\n    \u2502 \u2500\u2500 POST /product-catalog \u2500\u2500\u25ba                              \u2502\n    \u2502    Header: api-key=&lt;key&gt; \u2502                                \u2502\n    \u2502    Body: {\"method\":      \u2502                                \u2502\n    \u2502     \"initialize\"}        \u2502                                \u2502\n    \u2502                          \u2502\u2500\u2500 Validate subscription key \u2500\u2500\u25ba\u2502\n    \u2502                          \u2502\u2500\u2500 Route to MCP backend \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502\n    \u2502                          \u2502                                \u2502\u2500\u2500 Initialize MCP session\n    \u2502                          \u2502\u25c4\u2500\u2500 Session ID + capabilities \u2500\u2500\u2502\n    \u2502\u25c4\u2500\u2500\u2500 200 OK \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502                                \u2502\n    \u2502                          \u2502                                \u2502\n    \u2502 \u2500\u2500 POST /product-catalog \u2500\u2500\u25ba                              \u2502\n    \u2502    Body: {\"method\":      \u2502                                \u2502\n    \u2502     \"tools/list\"}        \u2502                                \u2502\n    \u2502                          \u2502\u2500\u2500 Forward to backend \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502\n    \u2502                          \u2502                                \u2502\u2500\u2500 Return 5 tools\n    \u2502                          \u2502\u25c4\u2500\u2500 Tool schemas \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n    \u2502\u25c4\u2500\u2500\u2500 200 OK \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502                                \u2502\n    \u2502                          \u2502                                \u2502\n    \u2502 \u2500\u2500 POST /product-catalog \u2500\u2500\u25ba                              \u2502\n    \u2502    Body: {\"method\":      \u2502                                \u2502\n    \u2502     \"tools/call\",        \u2502                                \u2502\n    \u2502     \"params\": {          \u2502                                \u2502\n    \u2502       \"name\":            \u2502                                \u2502\n    \u2502       \"search_products\", \u2502\u2500\u2500 Forward to backend \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502\n    \u2502       \"arguments\":       \u2502                                \u2502\u2500\u2500 Execute tool logic\n    \u2502       {\"query\":\"USB\"}}}  \u2502                                \u2502\u2500\u2500 Return results\n    \u2502                          \u2502\u25c4\u2500\u2500 Tool results \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502\n    \u2502\u25c4\u2500\u2500\u2500 200 OK \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502                                \u2502\n</code></pre>"},{"location":"architecture/#ai-agent-orchestration-agent-framework","title":"AI Agent Orchestration (Agent Framework)","text":"<pre><code>User               Agent Framework         APIM              Container App    AI Foundry\n  \u2502                     \u2502                   \u2502                      \u2502              \u2502\n  \u2502\u2500\u2500 \"Find USB\" \u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502                   \u2502                      \u2502              \u2502\n  \u2502                     \u2502\u2500\u2500 Chat completion \u25ba\u2502                      \u2502              \u2502\n  \u2502                     \u2502   (with tool defs) \u2502\u2500\u2500 Managed ID auth \u2500\u2500\u25ba\u2502              \u2502\n  \u2502                     \u2502                   \u2502                      \u2502              \u2502\n  \u2502                     \u2502\u25c4\u2500 tool_call \u2500\u2500\u2500\u2500\u2500\u2500\u2502\u25c4\u2500 GPT-4o-mini \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502              \u2502\n  \u2502                     \u2502   search_products \u2502                      \u2502              \u2502\n  \u2502                     \u2502                   \u2502                      \u2502              \u2502\n  \u2502                     \u2502\u2500\u2500 MCP tools/call \u25ba\u2502                      \u2502              \u2502\n  \u2502                     \u2502   api-key header  \u2502\u2500\u2500 Forward \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\u2502              \u2502\n  \u2502                     \u2502                   \u2502                      \u2502\u2500\u2500 Execute     \u2502\n  \u2502                     \u2502\u25c4\u2500 Tool results \u2500\u2500\u2500\u2502\u25c4\u2500\u2500 Results \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502              \u2502\n  \u2502                     \u2502                   \u2502                      \u2502              \u2502\n  \u2502                     \u2502\u2500\u2500 Chat completion \u25ba\u2502                      \u2502              \u2502\n  \u2502                     \u2502   (with results)  \u2502\u2500\u2500 Managed ID auth \u2500\u2500\u25ba\u2502              \u2502\n  \u2502                     \u2502\u25c4\u2500 Final answer \u2500\u2500\u2500\u2502\u25c4\u2500\u2500 Summary \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2502              \u2502\n  \u2502\u25c4\u2500\u2500 \"Found USB-C\u2026\" \u2500\u2502                   \u2502                      \u2502              \u2502\n</code></pre>"},{"location":"architecture/#azure-services-deep-dive","title":"Azure Services Deep Dive","text":""},{"location":"architecture/#azure-api-management-basicv2-sku","title":"Azure API Management (BasicV2 SKU)","text":"<p>Role: Unified gateway and governance layer for both MCP and LLM inference traffic.</p> Requirement How APIM Addresses It MCP protocol support v2 SKUs natively understand MCP \u2014 declare <code>type: 'mcp'</code> with <code>transportType: 'streamable'</code> Authentication Subscription key management (<code>api-key</code> header), OAuth 2.0, JWT validation, Microsoft Entra ID Single control plane Manage both MCP API and Inference API in one place Observability Integrated diagnostics \u2192 Log Analytics + Application Insights Policy engine Rate limiting, caching, IP filtering, request/response transformation Enterprise readiness Same APIM platform you may already use for REST APIs <p>Why BasicV2?</p> <p>The v2 tier is required for native MCP support (Classic tiers do not support <code>type: 'mcp'</code> APIs). BasicV2 is the most cost-effective v2 SKU \u2014 sufficient for development and testing. Upgrade to StandardV2 or PremiumV2 for production (VNet integration, higher throughput).</p> <pre><code>resource apimService 'Microsoft.ApiManagement/service@2024-06-01-preview' = {\n  sku: { name: 'Basicv2', capacity: 1 }\n  identity: { type: 'SystemAssigned' }  // For managed identity auth to AI Services\n}\n</code></pre>"},{"location":"architecture/#azure-container-apps","title":"Azure Container Apps","text":"<p>Role: Hosts the Product Catalog MCP server \u2014 the containerized backend that APIM routes MCP traffic to.</p> Requirement How Container Apps Addresses It Run containers without managing infra Fully managed \u2014 no VMs, no Kubernetes cluster to operate HTTP ingress Built-in HTTPS with auto-TLS termination. MCP server on port 8080 Scale to demand 1\u20133 replicas, scales based on HTTP traffic ACR integration Pulls images using a User-Assigned Managed Identity \u2014 no credentials stored Logging stdout/stderr streams directly to Log Analytics <p>Why not Azure Functions, App Service, or AKS?</p> <ul> <li>Azure Functions: MCP servers need long-lived HTTP connections; cold starts make this unreliable</li> <li>App Service: Would work, but Container Apps provides better autoscaling semantics</li> <li>AKS: Overkill for a single container \u2014 Container Apps gives Kubernetes benefits without operational complexity</li> </ul> <p>What runs inside: <pre><code>Python 3.13 slim \u2192 Uvicorn \u2192 Starlette ASGI app \u2192 FastMCP\n                                  \u2502\n                    Mount(\"/product-catalog\", app=mcp_asgi)\n                                  \u2502\n                         MCP endpoint at /product-catalog/mcp\n                                  \u2502\n                    5 tools: get_categories, get_products_by_category,\n                             get_product, search_products, check_stock\n</code></pre></p>"},{"location":"architecture/#azure-container-registry-acr","title":"Azure Container Registry (ACR)","text":"<p>Role: Builds and stores the MCP server container image in a private registry.</p> Requirement How ACR Addresses It Cloud build <code>az acr build</code> compiles in Azure \u2014 no local Docker daemon required Private storage Images stored in your subscription, no public registry dependency Managed Identity pull Container Apps uses UAI with <code>AcrPull</code> role"},{"location":"architecture/#azure-ai-foundry-cognitive-services","title":"Azure AI Foundry (Cognitive Services)","text":"<p>Role: Provides the LLM (GPT-4o-mini) that powers the Agent Framework demo.</p> Requirement How AI Foundry Addresses It GPT-4o-mini Cost-effective model with strong tool-use capabilities Managed identity auth APIM authenticates using system-assigned MI \u2014 no API keys over the wire Foundry project Organizes deployments and provides a project endpoint Azure-native Same data residency, compliance, and networking as the rest of the solution <p>RBAC chain: <pre><code>APIM (System Assigned MI) \u2500\u2500 Cognitive Services OpenAI Contributor \u2500\u2500\u25ba AI Foundry account\n</code></pre></p>"},{"location":"architecture/#log-analytics-application-insights","title":"Log Analytics + Application Insights","text":"<p>Role: Central observability layer \u2014 unified log collection, APM, and custom metrics.</p> <pre><code>APIM diagnostic settings \u2500\u2500\u2500\u2500\u2500\u2500\u25ba Log Analytics Workspace\nContainer App Environment \u2500\u2500\u2500\u2500\u2500\u2500\u25ba    (30-day retention)\nApplication Insights \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25ba\n</code></pre> Capability Details KQL queries Analyze MCP tool invocation patterns, error rates, latency distributions Custom metrics OpenAI token consumption with subscription/client/API dimensions End-to-end tracing Distributed tracing across APIM \u2192 backend Alerting Error rates, latency thresholds, token consumption"},{"location":"architecture/#security-architecture","title":"Security Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      Security Layers                              \u2502\n\u2502                                                                   \u2502\n\u2502  Layer 1: APIM Gateway Authentication                             \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502 \u2022 api-key subscription header (all APIs)                   \u2502   \u2502\n\u2502  \u2502 \u2022 Can add: OAuth 2.0, JWT validation, Microsoft Entra ID   \u2502   \u2502\n\u2502  \u2502 \u2022 Rate limiting and IP filtering via policies              \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                                   \u2502\n\u2502  Layer 2: APIM \u2192 Backend Authentication                           \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502 MCP API:       APIM \u2192 Container App (TLS, no extra auth)  \u2502   \u2502\n\u2502  \u2502 Inference API: APIM \u2192 AI Foundry (Managed Identity)        \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                                   \u2502\n\u2502  Layer 3: Resource-Level RBAC                                     \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502 APIM MI \u2192 Cognitive Services OpenAI Contributor            \u2502   \u2502\n\u2502  \u2502 Container App UAI \u2192 AcrPull \u2192 ACR                          \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                                   \u2502\n\u2502  Layer 4: Network &amp; Transport                                     \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502 \u2022 HTTPS everywhere (TLS at Container Apps ingress)         \u2502   \u2502\n\u2502  \u2502 \u2022 Production: VNet integration, private endpoints, WAF     \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"architecture/#apim-api-configuration","title":"APIM API Configuration","text":""},{"location":"architecture/#mcp-api-native-type","title":"MCP API (Native Type)","text":"<p>The Product Catalog API is declared as a native MCP type \u2014 not a REST API with custom policies:</p> <pre><code>resource mcp 'Microsoft.ApiManagement/service/apis@2024-06-01-preview' = {\n  properties: {\n    type: 'mcp'                    // Native MCP protocol handling\n    backendId: mcpBackend.name     // Routes to Container App\n    path: 'product-catalog'        // Exposed at /product-catalog\n    mcpProperties: {\n      transportType: 'streamable'  // Streamable HTTP transport\n    }\n    subscriptionKeyParameterNames: {\n      header: 'api-key'            // Same auth pattern as Inference API\n    }\n  }\n}\n</code></pre> <p>What <code>type: 'mcp'</code> gives you</p> <ul> <li>APIM understands MCP session lifecycle (initialize \u2192 tool discovery \u2192 tool calls)</li> <li>The <code>/product-catalog</code> path serves MCP directly \u2014 no <code>/mcp</code> suffix needed in the APIM URL</li> <li>Backend routing is MCP-aware \u2014 APIM forwards to <code>{backend-url}/mcp</code> automatically</li> <li>Compatible with all MCP clients that support Streamable HTTP transport</li> </ul>"},{"location":"architecture/#inference-api-rest-openapi","title":"Inference API (REST / OpenAPI)","text":"<pre><code>resource inferenceAPI 'Microsoft.ApiManagement/service/apis@2024-06-01-preview' = {\n  properties: {\n    path: 'inference'\n    format: 'openapi-link'   // Imports the official Azure OpenAI spec\n    subscriptionRequired: true\n    subscriptionKeyParameterNames: { header: 'api-key' }\n  }\n}\n</code></pre> <p>Policy pipeline: <code>authentication-managed-identity</code> \u2192 <code>set-header Authorization</code> \u2192 <code>set-backend-service</code> \u2192 <code>azure-openai-emit-token-metric</code></p>"},{"location":"architecture/#deployment-order","title":"Deployment Order","text":"<p>The Bicep template orchestrates deployment with implicit dependency resolution:</p> <pre><code>1. Log Analytics Workspace\n   \u2514\u2500\u2500\u25ba 2. Application Insights\n        \u2514\u2500\u2500\u25ba 3. API Management\n             \u251c\u2500\u2500\u25ba 4. AI Foundry + Model Deployments (RBAC)\n             \u2502    \u2514\u2500\u2500\u25ba 5. Inference API\n             \u251c\u2500\u2500\u25ba 6. Container Registry\n             \u2502    \u2514\u2500\u2500\u25ba 7. Container App Environment + Container App\n             \u2502         \u2514\u2500\u2500\u25ba 10. MCP API module\n             \u2514\u2500\u2500\u25ba (Inference API deploys before MCP API \u2014 explicit dependsOn)\n</code></pre> <p>Resource Naming</p> <p>All resources use <code>uniqueString(subscription().id, resourceGroup().id)</code> as a suffix \u2014 deterministic within a subscription+RG pair, unique across pairs. The notebook adds a random <code>run_suffix</code> to the resource group name so each run is fully isolated.</p>"},{"location":"architecture/#design-decisions","title":"Design Decisions","text":"Decision Rationale Trade-off BasicV2 SKU Lowest-cost v2 SKU with native MCP No VNet integration \u2014 use StandardV2+ for production Streamable HTTP Modern MCP transport, APIM v2 native support Requires MCP clients that support streamable transport Single subscription One <code>api-key</code> for both MCP and inference Production should use per-API subscriptions Public endpoints Lab simplicity Production: VNet, private endpoints, WAF In-memory data No external dependencies for demo Replace with a real data source for production Managed Identity Zero secrets in configuration Slightly more complex Bicep (RBAC assignments)"},{"location":"architecture/#production-considerations","title":"Production Considerations","text":"Area Lab Production APIM SKU BasicV2 StandardV2 or PremiumV2 (VNet, HA, zones) Networking Public endpoints Private endpoints, VNet integration Authentication API key OAuth 2.0, Microsoft Entra ID, JWT validation MCP server data In-memory Python list Azure SQL, Cosmos DB, or existing data tier Scaling 1\u20133 replicas HTTP concurrency rules, multiple APIM backends Monitoring Basic diagnostics Custom dashboards, alerts, anomaly detection CI/CD Manual notebook GitHub Actions / Azure DevOps pipelines Multi-region Single region APIM Premium, geo-replicated ACR"},{"location":"getting-started/","title":"Getting Started","text":"<p>Follow these steps to clone, set up, and run the workshop.</p>"},{"location":"getting-started/#clone-the-repository","title":"Clone the Repository","text":"<pre><code>git clone https://github.com/odaibert/api-modernization-with-mcp.git\ncd api-modernization-with-mcp\n</code></pre>"},{"location":"getting-started/#open-in-vs-code","title":"Open in VS Code","text":"<pre><code>code .\n</code></pre>"},{"location":"getting-started/#create-a-virtual-environment","title":"Create a Virtual Environment","text":"<pre><code>python3 -m venv .venv\nsource .venv/bin/activate   # macOS/Linux\n# .venv\\Scripts\\activate    # Windows\n</code></pre>"},{"location":"getting-started/#install-dependencies","title":"Install Dependencies","text":"<pre><code>pip install -r requirements.txt\n</code></pre>"},{"location":"getting-started/#open-the-notebook","title":"Open the Notebook","text":"<p>Navigate to <code>labs/expose-rest-api-as-mcp/</code> and open <code>expose-rest-api-as-mcp.ipynb</code> in VS Code.</p>"},{"location":"getting-started/#run-the-lab","title":"Run the Lab","text":"<p>You have two options:</p> Run AllStep by Step <p>Click Run All at the top of the notebook to execute every step sequentially. The entire deployment takes approximately 15\u201320 minutes (APIM provisioning is the longest step).</p> <p>Execute each cell individually to understand what each step does. The notebook is organized into clearly labeled sections with markdown explanations.</p>"},{"location":"getting-started/#repository-structure","title":"Repository Structure","text":"<pre><code>api-modernization-with-mcp/\n\u251c\u2500\u2500 labs/\n\u2502   \u2514\u2500\u2500 expose-rest-api-as-mcp/       # Lab notebook, Bicep templates, and README\n\u2502       \u251c\u2500\u2500 expose-rest-api-as-mcp.ipynb\n\u2502       \u251c\u2500\u2500 main.bicep\n\u2502       \u2514\u2500\u2500 policy.xml\n\u251c\u2500\u2500 modules/                           # Reusable Bicep modules\n\u2502   \u251c\u2500\u2500 apim/v2/                       # APIM v2 + Inference API\n\u2502   \u251c\u2500\u2500 apim-streamable-mcp/           # MCP API module\n\u2502   \u251c\u2500\u2500 cognitive-services/v3/         # AI Foundry\n\u2502   \u251c\u2500\u2500 monitor/v1/                    # Application Insights\n\u2502   \u2514\u2500\u2500 operational-insights/v1/       # Log Analytics\n\u251c\u2500\u2500 shared/                            # Shared code\n\u2502   \u251c\u2500\u2500 mcp-servers/product-catalog/   # MCP server source + Dockerfile\n\u2502   \u2514\u2500\u2500 utils.py                       # Notebook utilities\n\u251c\u2500\u2500 docs/                              # This documentation site\n\u251c\u2500\u2500 mkdocs.yml                         # MkDocs configuration\n\u2514\u2500\u2500 requirements.txt                   # Python dependencies\n</code></pre>"},{"location":"getting-started/#what-the-notebook-does","title":"What the Notebook Does","text":"Step Duration Description 0\ufe0f\u20e3 Initialize ~1s Set variables, generate unique resource suffix 1\ufe0f\u20e3 Verify Azure CLI ~2s Confirm login and subscription \ud83e\uddea Local test ~5s Start MCP server locally, verify 5 tools 2\ufe0f\u20e3 Deploy to Azure ~15min Bicep deployment (APIM takes longest) 3\ufe0f\u20e3 Get outputs ~5s Retrieve URLs, keys, resource names 4\ufe0f\u20e3 Build &amp; deploy ~3min Build container in ACR, deploy to Container Apps \ud83e\uddea Test tools ~10s Discover and call all MCP tools through APIM \ud83e\uddea Agent Framework ~15s AI agent uses MCP tools to answer a question \ud83d\uddd1\ufe0f Clean up ~1min Delete the resource group"},{"location":"getting-started/#troubleshooting","title":"Troubleshooting","text":"<p>APIM provisioning takes ~10-15 minutes</p> <p>The BasicV2 SKU deployment is the longest step. The notebook will wait for it to complete.</p> <p>Azure CLI not found</p> <p>If <code>az</code> is not found, ensure it's installed and on your PATH. The notebook automatically detects common install locations on macOS.</p> <p>Each run is isolated</p> <p>The notebook generates a unique random suffix for every execution, creating a new resource group each time. You can run multiple experiments in parallel without conflicts.</p> <p> Start the lab</p>"},{"location":"prerequisites/","title":"Prerequisites","text":"<p>Before starting the workshop, ensure you have the following tools and access configured.</p>"},{"location":"prerequisites/#required-tools","title":"Required Tools","text":"Tool Version Purpose Python 3.12 or later Run the Jupyter notebook and MCP server locally VS Code Latest IDE with Jupyter notebook support Azure CLI Latest Deploy infrastructure and manage Azure resources Azure Subscription \u2014 Host all deployed resources"},{"location":"prerequisites/#detailed-setup","title":"Detailed Setup","text":""},{"location":"prerequisites/#python-312","title":"Python 3.12+","text":"<p>Download and install from python.org.</p> <pre><code>python3 --version  # Should show 3.12.x or later\n</code></pre>"},{"location":"prerequisites/#vs-code-extensions","title":"VS Code + Extensions","text":"<ol> <li>Install VS Code</li> <li>Install the Jupyter extension</li> <li>Install the Python extension</li> </ol>"},{"location":"prerequisites/#azure-cli","title":"Azure CLI","text":"<p>Install from the official documentation.</p> <pre><code>az --version    # Verify installation\naz login        # Sign in to your Azure account\naz account show # Verify the correct subscription is selected\n</code></pre>"},{"location":"prerequisites/#azure-subscription-roles","title":"Azure Subscription Roles","text":"<p>Your account needs the following roles on the target subscription:</p> Role Why Contributor Create and manage all Azure resources (APIM, Container Apps, ACR, AI Foundry, etc.) RBAC Administrator Assign managed identity roles (APIM \u2192 AI Foundry, Container App \u2192 ACR) <p>Check your roles</p> <pre><code>az role assignment list --assignee $(az ad signed-in-user show --query id -o tsv) \\\n    --query \"[].roleDefinitionName\" -o tsv\n</code></pre>"},{"location":"prerequisites/#optional-tools","title":"Optional Tools","text":"Tool Purpose MCP Inspector Browser-based interactive testing of MCP servers GitHub Copilot Use MCP tools directly in VS Code Agent Mode"},{"location":"prerequisites/#verify-your-setup","title":"Verify Your Setup","text":"<p>Run this quick check to confirm everything is ready:</p> <pre><code># Python\npython3 --version\n\n# Azure CLI\naz version --query '\"azure-cli\"' -o tsv\n\n# Logged in\naz account show --query name -o tsv\n</code></pre> <p>Ready to go!</p> <p>If all three commands return valid output, head to Getting Started to begin the lab.</p>"},{"location":"labs/expose-rest-api-as-mcp/","title":"Lab: Expose a REST API as an MCP Server","text":""},{"location":"labs/expose-rest-api-as-mcp/#overview","title":"Overview","text":"<p>In this hands-on lab, you'll modernize a traditional Product Catalog REST API into an MCP-compliant server that AI agents can discover and invoke \u2014 all governed through Azure API Management.</p> <p>What You'll Build</p> <p>A complete end-to-end pipeline: REST API \u2192 MCP Server \u2192 Container App \u2192 APIM Gateway \u2192 AI Agent</p>"},{"location":"labs/expose-rest-api-as-mcp/#what-youll-learn","title":"What You'll Learn","text":"Concept Description MCP as a modernization pattern How MCP enables your existing APIs to be consumed by AI agents without rewriting business logic APIM as governance layer Security, monitoring, and policy enforcement for MCP traffic Streamable HTTP transport The modern MCP transport that APIM v2 SKUs natively support Agent Framework integration How the Microsoft Agent Framework connects to MCP tools through APIM Infrastructure as Code Full Bicep deployment for repeatable environments"},{"location":"labs/expose-rest-api-as-mcp/#what-gets-deployed","title":"What Gets Deployed","text":"Resource Purpose Azure API Management (BasicV2) Unified gateway with native MCP support Azure Container App Hosts the Product Catalog MCP server (FastMCP + Starlette) Azure Container Registry Builds and stores the MCP server container image Azure AI Foundry Provides GPT-4o-mini for the Agent Framework demo Log Analytics + App Insights Observability for all deployed resources"},{"location":"labs/expose-rest-api-as-mcp/#mcp-tools-exposed","title":"MCP Tools Exposed","text":"<p>The Product Catalog MCP server exposes five tools that AI agents can discover and invoke:</p> Tool Description Example Use <code>get_categories</code> List all product categories Agent explores what's available <code>get_products_by_category</code> Get products in a category \"Show me all Electronics\" <code>get_product</code> Get product details by ID Deep-dive on a specific item <code>search_products</code> Search by name or description \"Find wireless accessories\" <code>check_stock</code> Check stock availability \"Is PROD-001 in stock?\""},{"location":"labs/expose-rest-api-as-mcp/#notebook-walkthrough","title":"Notebook Walkthrough","text":"<p>Open <code>expose-rest-api-as-mcp.ipynb</code> and step through each section:</p> Step What Happens Duration 0\ufe0f\u20e3 Initialize Set variables and generate unique resource names ~1 min 1\ufe0f\u20e3 Verify Azure CLI Confirm login and subscription ~1 min \ud83e\uddea Local test Start MCP server locally, validate tools ~2 min 2\ufe0f\u20e3 Deploy to Azure Provision all resources via Bicep ~15 min 3\ufe0f\u20e3 Get outputs Retrieve URLs, keys, resource names ~1 min 4\ufe0f\u20e3 Build &amp; deploy Build container image, deploy to Container Apps ~5 min \ud83e\uddea Test via APIM Discover and call all 5 MCP tools through APIM ~3 min \ud83e\uddea Agent Framework AI agent uses MCP tools to answer questions ~3 min \ud83e\uddea VS Code integration Configure MCP server in Copilot Agent Mode ~2 min \ud83d\uddd1\ufe0f Clean up Delete all Azure resources ~5 min <p>Estimated Total Time</p> <p>~40 minutes end-to-end. The APIM deployment step takes the longest (~15 minutes).</p>"},{"location":"labs/expose-rest-api-as-mcp/#connecting-mcp-to-development-tools","title":"Connecting MCP to Development Tools","text":""},{"location":"labs/expose-rest-api-as-mcp/#vs-code-github-copilot-agent-mode","title":"VS Code + GitHub Copilot Agent Mode","text":"<p>After deployment, add the following to your <code>.vscode/mcp.json</code>:</p> <pre><code>{\n    \"servers\": {\n        \"product-catalog\": {\n            \"type\": \"http\",\n            \"url\": \"&lt;your-apim-gateway-url&gt;/product-catalog/mcp\"\n        }\n    }\n}\n</code></pre> <p>Then in Copilot chat, try:</p> <p>Copilot Agent Mode Prompts</p> <ul> <li>\"Search for products related to USB and check their stock\"</li> <li>\"List all categories and show me what's in Electronics\"</li> <li>\"Find me a wireless product and tell me if it's available\"</li> </ul>"},{"location":"labs/expose-rest-api-as-mcp/#mcp-inspector","title":"MCP Inspector","text":"<p>Use the MCP Inspector for interactive testing:</p> <pre><code>npx @modelcontextprotocol/inspector\n</code></pre> <p>Set transport to Streamable HTTP and point to your APIM MCP endpoint.</p>"},{"location":"labs/expose-rest-api-as-mcp/#the-bigger-picture","title":"The Bigger Picture","text":"<p>This lab demonstrates one of two patterns for bringing MCP to your organization through Azure API Management:</p> Pattern Description This Lab Expose REST API as MCP APIM fronts a backend MCP server that wraps existing APIs Pass-through MCP servers APIM proxies and governs traffic to existing MCP servers \u2014 <p>Both patterns let you modernize without rewriting \u2014 your existing business logic stays the same, while gaining AI-agent accessibility, enterprise security, and centralized governance.</p>"},{"location":"labs/expose-rest-api-as-mcp/#troubleshooting","title":"Troubleshooting","text":"APIM deployment is stuck or timing out <p>BasicV2 SKU deployments can take 15\u201320 minutes. This is normal. If it exceeds 25 minutes, check the Azure Portal for deployment status.</p> MCP tool calls return 401 Unauthorized <p>Verify the <code>api-key</code> header matches your APIM subscription key. Run the \"Get outputs\" cell in the notebook to retrieve the correct key.</p> Container App returns 503 Service Unavailable <p>The container may still be starting. Wait 1\u20132 minutes after deployment and retry. Check Container App logs in the Azure Portal.</p> Agent Framework demo returns empty responses <p>Ensure the AI Foundry deployment completed successfully and the GPT-4o-mini model is available. Check the Foundry project endpoint in the notebook outputs.</p>"},{"location":"resources/references/","title":"References","text":""},{"location":"resources/references/#material-blog-blog-posts","title":":material-blog: Blog Posts","text":"Resource Description Azure API Management now supports MCP Official announcement \u2014 MCP in v2 SKUs and external MCP-compliant server support"},{"location":"resources/references/#azure-documentation","title":"Azure Documentation","text":"Resource Description Expose APIs as MCP servers in Azure API Management Step-by-step guide for configuring APIM as an MCP gateway Connect to external MCP-compliant servers How to proxy and govern existing MCP servers through APIM Secure access to MCP servers Authentication patterns: API keys, OAuth 2.0, Microsoft Entra ID Discover MCP tools in Azure API Center Publish MCP tools for organization-wide discovery Azure API Management documentation Complete APIM documentation Azure Container Apps documentation Container Apps hosting and scaling Azure AI Foundry documentation AI Services and model deployments"},{"location":"resources/references/#mcp-specification","title":"MCP Specification","text":"Resource Description Model Context Protocol specification Official MCP spec \u2014 architecture, transports, and tool schemas MCP Streamable HTTP transport The transport type used in this lab MCP Inspector Interactive tool for testing MCP servers"},{"location":"resources/references/#github-repositories","title":"GitHub Repositories","text":"Resource Description Microsoft Agent Framework Python agent framework with MCP tool support Azure-Samples/AI-Gateway AI Gateway patterns and labs using Azure API Management FastMCP Pythonic MCP server framework used in this lab"},{"location":"resources/references/#development-tools","title":"Development Tools","text":"Tool Purpose VS Code IDE with Jupyter notebook support and Copilot Agent Mode Azure CLI Command-line tool for Azure resource management Bicep Infrastructure as Code language for Azure deployments Python 3.12+ Runtime for the MCP server and notebook"},{"location":"resources/references/#related-content","title":"Related Content","text":"Resource Description What is Model Context Protocol (MCP)? Video explanations of MCP concepts Azure API Management overview Key concepts and architecture of APIM"}]}